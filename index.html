<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Range Visualizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        html {
            height: 100%;
        }

        .upload-container, .legend-container, .info-container, .menu-container {
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            max-width: 600px;
            margin: 0;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            position: fixed;
            z-index: 1000;
            min-height: 200px;
        }

        .upload-container {
            top: 20px;
            left: 20px;
        }

        .legend-container {
            top: 20px;
            right: 20px;
            min-width: 300px;
        }

        .info-container {
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            max-width: 600px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }


        .menu-container.fixed {
            left: 20px;
            width: 300px;
        }

        .hidden {
            display: none;
        }

        .upload-icon, .legend-icon, .info-icon, .menu-icon {
            position: fixed;
            background-color: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1000;
        }

        .upload-icon {
            top: 20px;
            left: 20px;
        }

        .legend-icon {
            top: 20px;
            right: 20px;
        }

        .info-icon {
            bottom: 20px;
            right: 20px;
        }

        .menu-icon {
            left: 20px;
        }

        .upload-container h2, .legend-container h2, .info-container h2, .menu-container h2 {
            font-size: 24px;
            margin-bottom: 15px;
            color: #4a90e2;
            text-align: center;
            font-weight: bold;
        }

        .upload-container input[type="file"] {
            padding: 20px;
            border: 2px dashed #bcccdc;
            border-radius: 12px;
            margin-bottom: 15px;
            cursor: pointer;
            text-align: center;
            background-color: #f0f4f8;
            transition: background-color 0.3s ease, border 0.3s ease;
            font-size: 16px;
            color: #627d98;
        }

        .upload-container input[type="file"]:hover {
            background-color: #e0e6ed;
            border-color: #9fb3c8;
        }

        .upload-container button, .legend-container button, .info-container button, .menu-container button {
            background-color: #2f80ed;
            color: white;
            border: none;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            border-radius: 12px;
            transition: background-color 0.3s ease, transform 0.3s ease;
            font-size: 16px;
            font-weight: bold;
        }

        .upload-container button:hover, .legend-container button:hover, .info-container button:hover, .menu-container button:hover {
            background-color: #1c64d1;
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .upload-container label {
            font-size: 16px;
            color: #4a90e2;
            font-weight: 500;
        }

        .upload-container input[type="number"] {
            padding: 12px;
            border: 1px solid #bcccdc;
            border-radius: 8px;
            width: 30px;
            font-size: 16px;
            color: #334e68;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #333;
        }

    .main-container {
        display: flex;
        flex-direction: row;
        position: relative;
        top: 80px;
        transition: top 0.3s ease, margin-left 0.3s ease, width 0.3s ease;
        margin-left: 350px;
        width: calc(100% - 350px);
    }

    .range-image {
        margin-bottom: 0px;
        transition: width 0.3s ease;
    }

    .range-image canvas {
        width: 100%;
        height: auto;
    }

    .images-container {
        display: grid;
        width: 100%;
        overflow-y: auto;
    }
        .category {
            cursor: pointer;
            margin: 5px 0;
            background-color: #007bff;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
            display: block;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .category:hover {
            background-color: #0056b3;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .subcategory {
            margin-top: 5px;
            display: none;
            padding-left: 20px;
        }

        .tab {
            cursor: pointer;
            margin: 5px 0;
            background-color: #6c757d;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
            display: block;
            margin-left: 40px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .tab:hover {
            background-color: #5a6268;
        }

        .category i {
            margin-right: 10px;
            transition: transform 0.3s ease;
        }

        .expanded i {
            transform: rotate(90deg);
        }

        .selected {
            background-color: #28a745;
            color: #fff;
        }

        #columns-selector {
            margin-bottom: 15px;
        }

        .menu-container, .category, .subcategory, .tab {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .subcategory .category:hover {
            background-color: #0056b3;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .zoom-slider {
            width: 100%;
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }
		
		.button-container {
			display: flex;
			flex-direction: row;
			gap: 10px;
			justify-content: space-between;
		}

		body.dark-mode {
			background-color: #1e1e1e;
			color: #f5f5f5;
		}
	
		.upload-container.dark-mode, .legend-container.dark-mode, .info-container.dark-mode, .menu-container.dark-mode {
			background: linear-gradient(135deg, #333 0%, #444 100%);
			color: #f5f5f5;
		}
	
		.upload-container.dark-mode button, .legend-container.dark-mode button, .info-container.dark-mode button, .menu-container.dark-mode button {
			background-color: #4a90e2;
		}
	
		.upload-container.dark-mode button:hover, .legend-container.dark-mode button:hover, .info-container.dark-mode button:hover, .menu-container.dark-mode button:hover {
			background-color: #357ab8;
		}
	
		.upload-icon.dark-mode, .legend-icon.dark-mode, .info-icon.dark-mode, .menu-icon.dark-mode {
			background-color: #333;
		}
	
		.category.dark-mode, .tab.dark-mode {
			background-color: #555;
		}
	
		.category.dark-mode:hover, .tab.dark-mode:hover {
			background-color: #777;
		}
	
		.range-image.dark-mode canvas {
			border: 1px solid #fff;
		}
		
		body.dark-mode input[type="file"],
		body.dark-mode select {
			background-color: #333;
			color: #f5f5f5;
			border: 2px solid #555;
		}
	
		body.dark-mode input[type="file"]::file-selector-button {
			background-color: #4a90e2;
			color: #fff;
			border: 1px solid #357ab8;
			padding: 5px;
			cursor: pointer;
		}
	
		.upload-container.dark-mode input[type="file"]:hover {
			background-color: #1e1e1e;
		}
	
		body.dark-mode select {
			background-color: #444;
			color: #f5f5f5;
			border: 1px solid #666;
			padding: 10px;
		}
	
		body.dark-mode select option {
			background-color: #333;
			color: #f5f5f5;
		}
	
		body.dark-mode #columns-selector label,
		body.dark-mode label {
			color: #f5f5f5;
		}
	
#columns-selector input[type="number"],
#columns-selector select {
    padding: 10px;
    border: 1px solid #bcccdc;
    border-radius: 8px;
    font-size: 16px;
    color: #334e68;
    margin-left: 10px; /* Espace uniforme entre l'√©tiquette et l'input */
}

#columns-selector select {
    -webkit-appearance: none;  /* Pour supprimer l'apparence par d√©faut du select sur certains navigateurs */
    -moz-appearance: none;  /* Pour Firefox */
    appearance: none;
    background-color: #fff;
    cursor: pointer;
}

		#columns-selector.dark-mode input[type="number"],
		#columns-selector.dark-mode select,
		#languageSelector.dark-mode	{
			background-color: #444;
			color: #f5f5f5;
			border: 1px solid #666;
			padding: 10px;
		}
	
        #languageSelector {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #bcccdc;
            font-size: 16px;
            color: #334e68;
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22currentColor%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22 class=%22feather feather-chevron-down%22%3E%3Cpolyline points=%226 9 12 15 18 9%22%3E%3C/polyline%3E%3C/svg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
            width: 150px;
        }
		
		.info-container .language-dark-container {
            display: flex;
            align-items: center;
            justify-content: space-evenly;
        }
    </style>
</head>
<body>
    <div class="upload-icon" id="upload-icon" onclick="toggleUploadContainer()">
        <i class="fas fa-upload"></i>
    </div>

    <div class="upload-container" id="upload-container">
        <button class="close-button" onclick="toggleUploadContainer()">
            <i class="fas fa-times"></i>
        </button>
        <h2 id="uploadTitle">Upload Range Manager File</h2>
        <input type="file" id="fileInput" accept=".rm,.json,*/*" />
        <div class="button-container" style="display: flex; gap: 10px; margin-top: 10px;">
            <button id="showButton" onclick="handleFileUpload()"><i class="fas fa-file-upload"></i> Afficher</button>
            <button id="clearButton" onclick="clearImages()"><i class="fas fa-trash-alt"></i> Nettoyer</button>
        </div>
        <div id="columns-selector" style="display: flex; align-items: center;">
            <label id="columnsLabel" for="numColumns">Colonnes: </label>
            <input type="number" id="numColumns" value="4" min="1" max="8" onchange="updateImageLayout()">
            <select id="modeSelection" onchange="updateVisualizationMode()" style="margin-left: 10px;">
                <option value="normal">Normal</option>
                <option value="rta">RTA</option>
            </select>
        </div>
        <input type="range" id="zoomSlider" class="zoom-slider" min="0.2" max="4" step="0.1" value="1" oninput="updateZoom()">
        <label for="zoomSlider">Zoom: <span id="zoomValue">1</span>x</label>
    </div>

    <div class="legend-icon" id="legend-icon" onclick="toggleLegendContainer()">
        <i class="fas fa-list-alt"></i>
    </div>

    <div class="legend-container hidden" id="legend-container">
        <button class="close-button" onclick="toggleLegendContainer()">
            <i class="fas fa-times"></i>
        </button>
        <h2>L√©gendes des Actions</h2>
        <div id="legend-content"></div>
    </div>

    <div class="info-icon hidden" id="info-icon" onclick="toggleInfoContainer()">
        <i class="fas fa-info-circle"></i>
    </div>

	<div class="info-container" id="info-container">
		<button class="close-button" onclick="toggleInfoContainer()">
			<i class="fas fa-times"></i>
		</button>
		<div class="language-dark-container">
			<select id="languageSelector" onchange="changeLanguage()">
				<option value="fr" class="language-option fr" selected>üá´üá∑ Fran√ßais</option>
				<option value="en" class="language-option en">üá∫üá∏ English</option>
				<option value="es" class="language-option es">üá™üá∏ Espa√±ol</option>
			</select>
			<button id="darkModeToggle" onclick="toggleDarkMode()">Dark Mode</button>
		</div>
		<div id="infoContent">
			<p>Le <b>Poker Range Visualizer</b> est une application web qui vous permet de charger et de visualiser des ranges export√©es depuis <a href="https://range-manager.com/" target="_blank"><b>Range Manager</b></a>. Vous pouvez naviguer dans les cat√©gories et les ranges via le menu lat√©ral, afficher ou masquer les images correspondantes, ajuster le zoom sur les images, et personnaliser l'affichage en modifiant le nombre de colonnes. Les panneaux de contr√¥le et de menu peuvent √™tre r√©duits pour optimiser l'espace, et une l√©gende vous aide √† comprendre les actions repr√©sent√©es par les couleurs.</p>
			<p>Vos ranges sont trait√©es en local par votre navigateur et resteront priv√©es</p>
			<p>L'auteur de cette page n'a aucun lien avec Range Manager, ni ne per√ßoit de r√©mun√©ration mais vous encourage √† soutenir l'auteur de Range Manager, n'h√©sitez pas √† <a href="https://range-manager.com/buy/" target="_blank"><strong>Acheter une licence</strong></a>.</p>
		</div>
	</div>

    <div class="menu-icon hidden" id="menu-icon" onclick="toggleMenuContainer()" style="top: calc(20px + 20px + 20px + 200px);">
        <i class="fas fa-bars"></i>
    </div>

    <div class="menu-container fixed" id="menu-container" style="top: calc(20px + 20px + 20px + 200px);">
        <button class="close-button" onclick="toggleMenuContainer()">
            <i class="fas fa-times"></i>
        </button>
        <h2>Menu</h2>
        <div class="menu-content" id="menu-content">
            <!-- Le contenu du menu sera g√©n√©r√© ici -->
        </div>
    </div>

    <div class="main-container" id="main-container" style="margin-left: 350px;">
        <div class="images-container" id="images-container"></div>
    </div>

<script>
    function toggleDarkMode() {
        const body = document.body;
        body.classList.toggle('dark-mode');

        const containers = document.querySelectorAll('.upload-container, .legend-container, .info-container, .menu-container, .upload-icon, .legend-icon, .info-icon, .menu-icon, .range-image canvas,#columns-selector, #languageSelector');
        containers.forEach(container => {
            container.classList.toggle('dark-mode');
        });

        // Sauvegarder l'√©tat du Dark Mode dans le localStorage
        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('darkMode', 'enabled');
        } else {
            localStorage.setItem('darkMode', 'disabled');
        }
    }

    // Appliquer le Dark Mode si activ√© lors du chargement de la page
	
    window.addEventListener('load', function() {
        // Apply saved Dark Mode
        if (localStorage.getItem('darkMode') === 'enabled') {
            toggleDarkMode();
        }
		
        // Apply saved language
        const savedLanguage = localStorage.getItem('language');
        if (savedLanguage) {
            document.getElementById('languageSelector').value = savedLanguage;
            changeLanguage();
        }
		
        // Apply saved number of columns
        const savedNumColumns = localStorage.getItem('numColumns');
        if (savedNumColumns) {
            document.getElementById('numColumns').value = savedNumColumns;
            updateImageLayout();
        }
		
        // Apply saved visualization mode
        const savedVisualizationMode = localStorage.getItem('visualizationMode');
        if (savedVisualizationMode) {
            document.getElementById('modeSelection').value = savedVisualizationMode;
            updateVisualizationMode();
        }
		
        // Apply saved zoom level
        const savedZoomLevel = localStorage.getItem('zoomLevel');
        if (savedZoomLevel) {
            document.getElementById('zoomSlider').value = savedZoomLevel;
            updateZoom();
        }
		
        adjustContainerPositions();
        adjustImageContainerHeight();
    });

    window.addEventListener('resize', function() {
        adjustContainerPositions();
        adjustImageContainerHeight();
    });

        const translations = {
            en: {
                title: "Information",
                description: "The <b>Poker Range Visualizer</b> is a web application that allows you to upload and visualize ranges exported from <a href=\"https://range-manager.com/\" target=\"_blank\"><b>Range Manager</b></a>. Here are the main features: <ul><li><b>Intuitive Navigation</b>: Browse different categories and ranges using the side menu.</li><li><b>Display Control</b>: Show or hide corresponding images, adjust zoom for detailed views, and customize the layout by changing the number of columns.</li><li><b>Visualization Modes</b>: Switch between <b>normal</b> and <b>RTA</b> modes to visualize ranges according to your specific needs.</li><li><b>Interactive Interface</b>: Use buttons to upload, clear, or adjust the layout of images.</li><li><b>Dynamic Legend</b>: A legend helps interpret actions represented by colors on the images.</li><li><b>Privacy Assurance</b>: All range data is processed locally in your browser and remains private.</li></ul> The author of this page is not affiliated with <b>Range Manager</b> and does not receive any compensation for this service. You can support the author of Range Manager by <a href=\"https://range-manager.com/buy/\" target=\"_blank\"><strong>buying a license</strong></a>.",
                uploadTitle: "Upload Range Manager File",
                showButton: "Show",
                clearButton: "Clear",
                columnsLabel: "Columns:"
            },
            fr: {
                title: "Informations",
                description: "<p>Le <b>Poker Range Visualizer</b> est une application web qui vous permet de charger et de visualiser des ranges export√©es depuis <a href=\"https://range-manager.com/\" target=\"_blank\"><b>Range Manager</b></a>. Voici les fonctionnalit√©s principales :</p><ul><li><b>Navigation intuitive</b> : Parcourez les diff√©rentes cat√©gories et ranges √† l'aide du menu lat√©ral.</li><li><b>Contr√¥le de l'affichage</b> : Affichez ou masquez les images correspondantes, ajustez le zoom pour une vue d√©taill√©e et personnalisez l'agencement en modifiant le nombre de colonnes.</li><li><b>Modes de visualisation</b> : Passez en mode <b>normal</b> ou <b>RTA</b> pour afficher les ranges selon vos besoins sp√©cifiques.</li><li><b>Interface interactive</b> : Utilisez les boutons pour charger, nettoyer ou ajuster la mise en page des images.</li><li><b>L√©gende dynamique</b> : Une l√©gende vous aide √† interpr√©ter les actions, repr√©sent√©es par des couleurs sur les images.</li><li><b>Respect de la confidentialit√©</b> : Toutes les donn√©es de range sont trait√©es localement dans votre navigateur et restent enti√®rement priv√©es.</li></ul> L'auteur de cette page n'est pas affili√© √† <b>Range Manager</b> et ne per√ßoit aucune r√©mun√©ration pour ce service. Vous pouvez soutenir l'auteur de Range Manager en <a href=\"https://range-manager.com/buy/\" target=\"_blank\"><strong>achetant une licence</strong></a>.",
                uploadTitle: "Charger un fichier Range Manager",
                showButton: "Afficher",
                clearButton: "Nettoyer",
                columnsLabel: "Colonnes :"
            },
            es: {
                title: "Informaci√≥n",
                description: "El <b>Poker Range Visualizer</b> es una aplicaci√≥n web que le permite cargar y visualizar rangos exportados de <a href=\"https://range-manager.com/\" target=\"_blank\"><b>Range Manager</b></a>. Las funciones principales son: <ul><li><b>Navegaci√≥n intuitiva</b>: Explore diferentes categor√≠as y rangos mediante el men√∫ lateral.</li><li><b>Control de visualizaci√≥n</b>: Muestre u oculte las im√°genes correspondientes, ajuste el zoom para una vista detallada y personalice el dise√±o cambiando el n√∫mero de columnas.</li><li><b>Modos de visualizaci√≥n</b>: Cambie entre los modos <b>normal</b> y <b>RTA</b> para visualizar los rangos seg√∫n sus necesidades espec√≠ficas.</li><li><b>Interfaz interactiva</b>: Utilice los botones para cargar, limpiar o ajustar la disposici√≥n de las im√°genes.</li><li><b>Leyenda din√°mica</b>: Una leyenda le ayuda a interpretar las acciones representadas por los colores en las im√°genes.</li><li><b>Privacidad garantizada</b>: Todos los datos de los rangos se procesan localmente en su navegador y permanecen privados.</li></ul> El autor de esta p√°gina no est√° afiliado a <b>Range Manager</b> y no recibe ninguna compensaci√≥n por este servicio. Puede apoyar al autor de Range Manager <a href=\"https://range-manager.com/buy/\" target=\"_blank\"><strong>comprando una licencia</strong></a>.",
                uploadTitle: "Subir archivo de Range Manager",
                showButton: "Mostrar",
                clearButton: "Limpiar",
                columnsLabel: "Columnas:"
            }
        };

        function changeLanguage() {
            const selectedLanguage = document.getElementById('languageSelector').value;
			localStorage.setItem('language', selectedLanguage);
            const translation = translations[selectedLanguage];
            
            // Mettre √† jour le contenu traduit dans le bloc d'informations
            document.getElementById('infoContent').innerHTML = `
                <h2>${translation.title}</h2>
                <p>${translation.description}</p>
            `;
            
            // Mettre √† jour le contenu traduit dans le bloc d'upload
            document.getElementById('uploadTitle').innerText = translation.uploadTitle;
            document.getElementById('showButton').innerHTML = `<i class="fas fa-file-upload"></i> ${translation.showButton}`;
            document.getElementById('clearButton').innerHTML = `<i class="fas fa-trash-alt"></i> ${translation.clearButton}`;
            document.getElementById('columnsLabel').innerText = translation.columnsLabel;
        }

// Initialiser la langue par d√©faut
window.addEventListener('load', changeLanguage);

    let visualizationMode = 'normal';

    function updateVisualizationMode() {
        const modeSelection = document.getElementById('modeSelection');
		visualizationMode = modeSelection.value;
		localStorage.setItem('visualizationMode', visualizationMode);
        if (visualizationMode === 'rta') {
            // If switching to RTA mode, reinitialize the image layout to match RTA rules
            applyRtaMode();
        } else {
            // Reinitialize normal mode display
            updateImageLayout();
        }
    }

    function adjustContainerPositions() {
        const uploadContainer = document.getElementById('upload-container');
        const menuContainer = document.getElementById('menu-container');
        const menuIcon = document.getElementById('menu-icon');
        const mainContainer = document.getElementById('main-container');
        const offset = uploadContainer.classList.contains('hidden') ? 80 : uploadContainer.offsetHeight + 40;

        mainContainer.style.top = `${offset}px`;
        menuContainer.style.top = `${offset}px`;
        menuIcon.style.top = `${offset}px`;
    }

    let zoomLevel = 1;
    let rangesData = null;
	let chartConfig = null;
	let backgroundColor = '#ffffff'; // Couleur de fond par d√©faut
	let fontColor = '#000000'; // Couleur de la police par d√©faut


        function handleFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a file to upload.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const fileContent = event.target.result;
                try {
                    const rangesData = JSON.parse(fileContent);
                    displayCategorySelection(rangesData);
                    updateLegend(rangesData);
                    document.querySelector('.legend-container').classList.remove('hidden');
                    document.querySelector('.legend-icon').classList.add('hidden');
					chartConfig = rangesData.config?.chart;
					backgroundColor = chartConfig?.backgroundColor || '#ffffff'; // Couleur de fond par d√©faut
					fontColor = chartConfig?.fontColor || '#000000'; // Couleur de la police par d√©faut
                } catch (error) {
                    alert('Invalid JSON format. Please upload a valid file.');
                }
            };
            reader.readAsText(file);
        }

        function toggleUploadContainer() {
            const uploadContainer = document.getElementById('upload-container');
            const uploadIcon = document.getElementById('upload-icon');
            const mainContainer = document.getElementById('main-container');
            const menuContainer = document.getElementById('menu-container');
            const menuIcon = document.getElementById('menu-icon');
            if (uploadContainer.classList.contains('hidden')) {
                uploadContainer.classList.remove('hidden');
                uploadIcon.classList.add('hidden');
                mainContainer.style.top = `${uploadContainer.offsetHeight + 40}px`;
                menuContainer.style.top = `${uploadContainer.offsetHeight + 80}px`;
                menuIcon.style.top = `${uploadContainer.offsetHeight + 80}px`;
                adjustImageContainerHeight();
            } else {
                uploadContainer.classList.add('hidden');
                uploadIcon.classList.remove('hidden');
                mainContainer.style.top = '80px';
                menuContainer.style.top = '100px';
                menuIcon.style.top = '100px';
                adjustImageContainerHeight();
            }
        }

        function toggleLegendContainer() {
            const legendContainer = document.getElementById('legend-container');
            const legendIcon = document.getElementById('legend-icon');
            if (legendContainer.classList.contains('hidden')) {
                legendContainer.classList.remove('hidden');
                legendIcon.classList.add('hidden');
                updateLegend(window.rangesData);
            } else {
                legendContainer.classList.add('hidden');
                legendIcon.classList.remove('hidden');
            }
        }

        function toggleInfoContainer() {
            const infoContainer = document.getElementById('info-container');
            const infoIcon = document.getElementById('info-icon');
            if (infoContainer.classList.contains('hidden')) {
                infoContainer.classList.remove('hidden');
                infoIcon.classList.add('hidden');
            } else {
                infoContainer.classList.add('hidden');
                infoIcon.classList.remove('hidden');
            }
            adjustImageContainerHeight();
        }

    function toggleMenuContainer() {
        const menuContainer = document.getElementById('menu-container');
        const menuIcon = document.getElementById('menu-icon');
        const mainContainer = document.getElementById('main-container');
        if (menuContainer.classList.contains('hidden')) {
            menuContainer.classList.remove('hidden');
            menuIcon.classList.add('hidden');
            mainContainer.style.marginLeft = '350px';
            mainContainer.style.width = 'calc(100% - 350px)';
        } else {
            menuContainer.classList.add('hidden');
            menuIcon.classList.remove('hidden');
            mainContainer.style.marginLeft = '80px';
            mainContainer.style.width = 'calc(100% - 80px)';
        }
        adjustImageContainerHeight();
    }


        function displayCategorySelection(rangesData) {
            const menuContent = document.getElementById('menu-content');
            menuContent.innerHTML = '';
            window.rangesData = rangesData;

            const categories = rangesData.categories;
            if (!categories) {
                menuContent.innerHTML = '<p>Aucune cat√©gorie trouv√©e dans le fichier.</p>';
                return;
            }

            function createCategoryElement(categoryId, parentPath) {
                const category = categories[categoryId];
                if (!category) return null;

                const newPath = parentPath ? parentPath + ' > ' + category.name : category.name;

                const categoryElement = document.createElement('div');
                categoryElement.className = 'category';
                categoryElement.innerHTML = `<i class="fas fa-angle-right"></i>${category.name}`;
                categoryElement.onclick = function(event) {
                    event.stopPropagation();

                    const subcategoryElement = categoryElement.querySelector('.subcategory');
                    if (subcategoryElement) {
                        const isExpanded = subcategoryElement.style.display === 'block';
                        if (!isExpanded) {
                            subcategoryElement.style.display = 'block';
                            categoryElement.classList.add('expanded');
                            const icon = categoryElement.querySelector('i');
                            if (icon) {
                                icon.className = 'fas fa-angle-down';
                            }
                            scrollToCategory(categoryElement);
                        } else {
                            subcategoryElement.style.display = 'none';
                            categoryElement.classList.remove('expanded');
                            const icon = categoryElement.querySelector('i');
                            if (icon) {
                                icon.className = 'fas fa-angle-right';
                            }
                        }
                    }
                    // Adjust menu container scroll after expanding/collapsing
                    adjustMenuScroll();
                };

                if (category.children) {
                    const subcategoryElement = createSubcategoryElement(category, newPath, category.children, false);
                    if (subcategoryElement) {
                        categoryElement.appendChild(subcategoryElement);
                    }
                } else if (category.tabList) {
                    const subcategoryElement = createSubcategoryElement(category, newPath, category.tabList, true);
                    if (subcategoryElement) {
                        categoryElement.appendChild(subcategoryElement);
                    }
                }

                return categoryElement;
            }

            function createSubcategoryElement(category, newPath, items, isTabList) {
                const subcategoryElement = document.createElement('div');
                subcategoryElement.className = 'subcategory';
                subcategoryElement.style.display = 'none';

                items.forEach(id => {
                    if (isTabList) {
                        if (category.tabs && category.tabs[id]) {
                            const tab = category.tabs[id];
                            const tabElement = document.createElement('div');
                            tabElement.className = 'tab';
                            tabElement.textContent = tab.name;
                            tabElement.dataset.fullName = newPath + ' > ' + tab.name;
                            tabElement.onclick = function(event) {
                                event.stopPropagation();
                                toggleRangeImage(tab, newPath + ' > ' + tab.name, rangesData);
                            };
                            subcategoryElement.appendChild(tabElement);
                        }
                    } else {
                        const childCategoryElement = createCategoryElement(id, newPath);
                        if (childCategoryElement) {
                            subcategoryElement.appendChild(childCategoryElement);
                        }
                    }
                });

                return subcategoryElement;
            }

            if (categories.root && categories.root.children) {
                categories.root.children.forEach(childId => {
                    const rootCategoryElement = createCategoryElement(childId, '');
                    if (rootCategoryElement) {
                        menuContent.appendChild(rootCategoryElement);
                    }
                });
            } else {
                menuContent.innerHTML = '<p>Aucune cat√©gorie racine trouv√©e.</p>';
            }
        }

        function adjustMenuScroll() {
            const menuContainer = document.getElementById('menu-container');
            menuContainer.style.overflowY = 'auto';
            menuContainer.style.maxHeight = `${window.innerHeight - menuContainer.getBoundingClientRect().top - 20}px`;
        }

        function scrollToCategory(categoryElement) {
            const menuContainer = document.getElementById('menu-container');
            const categoryOffsetTop = categoryElement.offsetTop;
            menuContainer.scrollTop = categoryOffsetTop - menuContainer.offsetTop;
        }

function toggleRangeImage(tab, tabFullName, rangesData) {
    const imagesContainer = document.getElementById('images-container');
    const existingImage = [...imagesContainer.children].find(child => child.dataset.fullName === tabFullName);

    const tabElements = document.querySelectorAll('.tab');
    let tabElement = null;
    tabElements.forEach(element => {
        if (element.dataset.fullName === tabFullName) {
            tabElement = element;
        }
    });

    if (existingImage) {
        // In RTA mode, if an existing image is clicked, move it to the front (leftmost position)
        if (visualizationMode === 'rta') {
            imagesContainer.removeChild(existingImage);
            imagesContainer.insertBefore(existingImage, imagesContainer.firstChild);
            return;
        } else {
            imagesContainer.removeChild(existingImage);
            if (tabElement) tabElement.classList.remove('selected');
            return;
        }
    }

    const combinedHands = {};

    if (Array.isArray(tab.rangeList)) {
        tab.rangeList.forEach(range => {
            if (range && rangesData.ranges[range.id]) {
                const rangeData = rangesData.ranges[range.id];
                const color = rangeData.color;
                const type = rangeData.type;
                const labels = tab.labels || null;
                const gridMode = tab.gridMode || 'default';

                if (Array.isArray(range.hands)) {
                    range.hands.forEach(hand => {
                        const [handName, ratio] = hand.split(':');
                        const ratioValue = ratio ? parseFloat(ratio) : 1.0;
                        if (!combinedHands[handName]) {
                            combinedHands[handName] = [];
                        }
                        combinedHands[handName].push({ color, type, ratio: ratioValue, labels, gridMode });
                    });
                }
            }
        });
    } else {
        console.error('tab.rangeList is not defined or not an array:', tab.rangeList);
        alert('No ranges found for this tab.');
        return;
    }

    generateRangeImage(combinedHands, tabFullName);
    if (tabElement) tabElement.classList.add('selected');

    // Apply RTA mode constraints if necessary
    if (visualizationMode === 'rta') {
        imagesContainer.insertBefore(imagesContainer.lastChild, imagesContainer.firstChild);
        applyRtaMode();
    }
}

function generateRangeImage(handsWithColors, rangeName) {
    const canvas = document.createElement('canvas');
    canvas.width = 1170;
    canvas.height = 1170;
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    const gridSize = 90; // Taille de la grille ajust√©e
    const labels = ['A', 'K', 'Q', 'J', 'T', '9', '8', '7', '6', '5', '4', '3', '2'];

    ctx.fillStyle = backgroundColor;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = fontColor;
    ctx.font = '42px Arial'; // Taille de police ajust√©e

    // Offsets pour les labels
    const labelOffsetX = gridSize / 2 - 15;
    const labelOffsetY = 30;

    // Dessiner les labels des colonnes
    for (let i = 0; i < 13; i++) {
        ctx.fillText(labels[i], i * gridSize + labelOffsetX, labelOffsetY);
    }

    // Dessiner les labels des lignes
    for (let i = 0; i < 13; i++) {
        ctx.fillText(labels[i], 10, i * gridSize + gridSize / 2 + 15);
    }

    // Dessiner les rectangles des mains
    for (let row = 0; row < 13; row++) {
        for (let col = 0; col < 13; col++) {
            let rank1 = labels[row];
            let rank2 = labels[col];
            let displayHand;
            let isSuited = row < col;

            if (row === col) {
                displayHand = rank1 + rank2;
            } else if (isSuited) {
                displayHand = rank1 + rank2 + 's';
            } else {
                displayHand = rank2 + rank1 + 'o';
            }

            // D√©terminer la couleur du rectangle
            if (handsWithColors[displayHand]) {
                const handDetails = handsWithColors[displayHand];
                const gridMode = handDetails[0].gridMode;
                const hasLabels = handDetails[0].labels;
                const fontSize = hasLabels && gridMode === 'small-init' ? '24px' : '35px';

                // Si plusieurs actions ou un ratio < 1 en mode small-init, dessiner les couleurs proportionnellement
                if (handDetails.length > 1 || (gridMode === 'small-init' && handDetails.some(detail => detail.ratio < 1))) {
                    let startX = col * gridSize + 1;
                    handDetails.forEach(({ color, type, ratio }) => {
                        if (type === 'color') {
                            const width = (gridSize - 2) * ratio;
                            ctx.fillStyle = color;
                            ctx.fillRect(startX, row * gridSize + 1, width, gridSize - 2);
                            startX += width;
                        }
                    });
                } else if (handDetails.length === 1) {
                    const { color, type } = handDetails[0];
                    if (type === 'color') {
                        ctx.fillStyle = color;
                        ctx.fillRect(col * gridSize + 1, row * gridSize + 1, gridSize - 2, gridSize - 2);
                    }
                }

				// Dessiner la bordure si n√©cessaire
				const borderDetails = handDetails.filter(({ type }) => type === 'border');
				if (borderDetails.length > 0) {
					const borderThickness = 10;
					const halfBorder = borderThickness / 2;
					const totalPerimeter = 4 * gridSize;
					let lengthAccumulated = 0;
				
					// D√©finir les c√¥t√©s et leurs positions de d√©part/fin le long du p√©rim√®tre
					const sides = [
						{
							side: 'left',
							length: gridSize,
							startPos: 0,
							draw: function(ctx, start, end) {
								const x = col * gridSize + halfBorder;
								ctx.moveTo(x, (row + 1) * gridSize - start);
								ctx.lineTo(x, (row + 1) * gridSize - end);
							}
						},
						{
							side: 'bottom',
							length: gridSize,
							startPos: gridSize,
							draw: function(ctx, start, end) {
								const y = (row + 1) * gridSize - halfBorder;
								ctx.moveTo(col * gridSize + start, y);
								ctx.lineTo(col * gridSize + end, y);
							}
						},
						{
							side: 'right',
							length: gridSize,
							startPos: 2 * gridSize,
							draw: function(ctx, start, end) {
								const x = (col + 1) * gridSize - halfBorder;
								ctx.moveTo(x, row * gridSize + start);
								ctx.lineTo(x, row * gridSize + end);
							}
						},
						{
							side: 'top',
							length: gridSize,
							startPos: 3 * gridSize,
							draw: function(ctx, start, end) {
								const y = row * gridSize + halfBorder;
								ctx.moveTo((col + 1) * gridSize - start, y);
								ctx.lineTo((col + 1) * gridSize - end, y);
							}
						}
					];
				
					borderDetails.forEach(({ color, ratio }) => {
						const lengthToCover = totalPerimeter * ratio;
						let lengthRemaining = lengthToCover;
						let currentPosition = lengthAccumulated;
				
						ctx.strokeStyle = color;
						ctx.lineWidth = borderThickness;
				
						while (lengthRemaining > 0 && currentPosition < totalPerimeter) {
							// D√©terminer le c√¥t√© actuel
							let side = null;
							for (let i = 0; i < sides.length; i++) {
								if (currentPosition >= sides[i].startPos && currentPosition < sides[i].startPos + sides[i].length) {
									side = sides[i];
									break;
								}
							}
				
							if (!side) break; // S√©curit√©
				
							const sidePos = currentPosition - side.startPos;
							const lengthOnSide = Math.min(lengthRemaining, side.length - sidePos);
				
							ctx.beginPath();
				
							side.draw(ctx, sidePos, sidePos + lengthOnSide);
				
							ctx.stroke();
				
							lengthRemaining -= lengthOnSide;
							currentPosition += lengthOnSide;
						}
				
						lengthAccumulated += lengthToCover;
					});
				}

                // Dessiner le contenu de la case en fonction des labels et du gridMode
                if (hasLabels) {
                    ctx.fillStyle = fontColor;
                    if (gridMode === 'small-init') {
                        // Afficher le nom de la main avec une taille de police normale
                        ctx.font = `normal 28px Arial`;
                        const label = handDetails[0].labels[displayHand] || '';
                        const textWidthHand = ctx.measureText(displayHand).width;
                        ctx.fillText(displayHand, col * gridSize + (gridSize - textWidthHand) / 2, row * gridSize + gridSize / 2 - 15);
                        // Afficher le label avec une taille de police plus grande
                        ctx.font = `normal 32px Arial`;
                        const textWidthLabel = ctx.measureText(label).width;
                        ctx.fillText(label, col * gridSize + (gridSize - textWidthLabel) / 2, row * gridSize + gridSize / 2 + 20);
                    } else {
                        // Afficher uniquement le label
                        ctx.font = `normal 32px Arial`;
                        const label = handDetails[0].labels[displayHand] || '';
                        const labelLines = label.split(' ');
                        const lineSpacing = 30; // Espacement entre les lignes
                        labelLines.forEach((line, index) => {
                            const textWidth = ctx.measureText(line).width;
                            ctx.fillText(line, col * gridSize + (gridSize - textWidth) / 2, row * gridSize + gridSize / 2 - 10 + (index * lineSpacing));
                        });
                    }
                }
            } else {
                ctx.fillStyle = backgroundColor;
                ctx.fillRect(col * gridSize + 1, row * gridSize + 1, gridSize - 2, gridSize - 2);
            }

            // Dessiner le texte de la main si aucun label n'est pr√©sent
            if (!handsWithColors[displayHand] || !handsWithColors[displayHand][0].labels) {
                ctx.fillStyle = fontColor;
                ctx.font = 'bold 35px Arial';
                const textWidth = ctx.measureText(displayHand).width;
                ctx.fillText(displayHand, col * gridSize + (gridSize - textWidth) / 2, row * gridSize + gridSize / 2 + 10);
            }
        }
    }

    // Dessiner les lignes de la grille apr√®s les rectangles
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2;
    for (let i = 0; i <= 13; i++) {
        ctx.beginPath();
        ctx.moveTo(i * gridSize + 0.5, 0);
        ctx.lineTo(i * gridSize + 0.5, gridSize * 13);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0, i * gridSize + 0.5);
        ctx.lineTo(gridSize * 13, i * gridSize + 0.5);
        ctx.stroke();
    }

    const imagesContainer = document.getElementById('images-container');
    const rangeImage = document.createElement('div');
    rangeImage.classList.add('range-image');
    rangeImage.dataset.fullName = rangeName;
    rangeImage.innerHTML = `<h3>${rangeName}</h3>`;
    rangeImage.appendChild(canvas);

    const baseImageWidth = 350; // Conserver le redimensionnement √† la fin
    const imageWidth = baseImageWidth * zoomLevel;
    rangeImage.style.width = `${imageWidth}px`;

    imagesContainer.appendChild(rangeImage);

    updateImageLayout();
}

function applyRtaMode() {
    const imagesContainer = document.getElementById('images-container');
    const numColumns = parseInt(document.getElementById('numColumns').value, 10);
    const maxImages = numColumns;

    // Remove the rightmost image if more than the allowed number are displayed
    while (imagesContainer.children.length > maxImages) {
        const lastImage = imagesContainer.lastChild;
        if (lastImage) {
            imagesContainer.removeChild(lastImage);
            // Deselect the corresponding menu tab
            const tabElements = document.querySelectorAll('.tab.selected');
            tabElements.forEach(tab => {
                if (tab.dataset.fullName === lastImage.dataset.fullName) {
                    tab.classList.remove('selected');
                }
            });
        }
    }
}
	
function updateLegend(rangesData) {
    const legendContent = document.getElementById('legend-content');
    legendContent.innerHTML = '';

    const ranges = rangesData.ranges;
    if (ranges) {
        Object.keys(ranges).forEach(rangeId => {
            const range = ranges[rangeId];
            if (range.color && range.name) {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="${range.type === 'border' ? 'border: 5px solid ' + range.color + '; width: 15px; height: 15px;' : 'background-color: ' + range.color};"></div>
                    <span>${range.name}</span>
                `;
                legendContent.appendChild(legendItem);
            }
        });
    }

    document.querySelector('.legend-icon').classList.add('hidden');
}

function updateImageLayout() {
    adjustImageContainerHeight();
    const imagesContainer = document.getElementById('images-container');
    const numColumns = parseInt(document.getElementById('numColumns').value, 10);
	localStorage.setItem('numColumns', numColumns);
    const gap = 10; // Fixer un espacement constant entre les images

    const baseImageWidth = 350; // Largeur de base de l'image
    const imageWidth = baseImageWidth * zoomLevel;

    // Calculer la largeur totale disponible pour les images
    const containerWidth = imagesContainer.clientWidth;

    // Ajuster le nombre de colonnes en fonction de l'espace disponible
    let adjustedNumColumns = numColumns;
    while (adjustedNumColumns > 1 && (adjustedNumColumns * imageWidth + (adjustedNumColumns - 1) * gap) > containerWidth) {
        adjustedNumColumns--;
    }

    imagesContainer.style.display = 'grid';
    imagesContainer.style.gridTemplateColumns = `repeat(${adjustedNumColumns}, ${imageWidth}px)`;
    imagesContainer.style.gap = `${gap}px`;
}


function updateZoom() {
    const zoomSlider = document.getElementById('zoomSlider');
    zoomLevel = parseFloat(zoomSlider.value);
    document.getElementById('zoomValue').innerText = zoomLevel.toFixed(1);
	localStorage.setItem('zoomLevel', zoomLevel);

    const baseImageWidth = 350; // Base width of image
    const imageWidth = baseImageWidth * zoomLevel;

    const rangeImages = document.querySelectorAll('.range-image');
    rangeImages.forEach(rangeImage => {
        rangeImage.style.width = `${imageWidth}px`;
    });

    updateImageLayout();
}

function clearImages() {
	const imagesContainer = document.getElementById('images-container');
	imagesContainer.innerHTML = '';

	const tabElements = document.querySelectorAll('.tab.selected');
	tabElements.forEach(tab => tab.classList.remove('selected'));
}
		
function adjustImageContainerHeight() {
    const imagesContainer = document.getElementById('images-container');
    const uploadContainer = document.getElementById('upload-container');
    const availableHeight = window.innerHeight - uploadContainer.offsetHeight - 120; // Ajustement pour laisser un peu de marge
    imagesContainer.style.height = `${availableHeight}px`;
    imagesContainer.style.overflowY = 'auto'; // Permettre le d√©filement vertical si n√©cessaire
}
    </script>
</body>
</html>
